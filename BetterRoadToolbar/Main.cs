using ICities;
using CitiesHarmony.API;
using ColossalFramework.UI;

namespace BetterRoadToolbar
{
    public class Mod : IUserMod
    {
        public string Name => "Better Road Toolbar";
        public string Description => "Adds more tabs in the Roads toolbar and changes sort order to make finding the right road that little bit easier.";

        public void OnEnabled()
        {
            HarmonyHelper.DoOnHarmonyReady(() => Patcher.PatchAll());
        }

        public void OnDisabled()
        {
            if (HarmonyHelper.IsHarmonyInstalled) Patcher.UnpatchAll();
        }

        public void OnSettingsUI(UIHelperBase helper)
        {
            helper.AddSpace(16);
            var dontExtractTransportModesCheckbox = (UICheckBox)helper.AddCheckbox("Don't extract Bus/Tram/Bike/Trolleybus/Monorail roads into separate tabs",
                !CurrentConfig.CreateTabsForTransportModes,
                (isChecked) => CurrentConfig.Update(createTabsForTransportModes : !isChecked));

            var useStandardSortingCheckbox = (UICheckBox)helper.AddCheckbox("Use standard sort order for roads", 
                CurrentConfig.UseStandardSortOrder,
                (isChecked) => CurrentConfig.Update(useStandardSortOrder : isChecked));

            var ignoreCustomTabsCheckbox = (UICheckBox)helper.AddCheckbox("Keep custom road tabs generated by other mods/DLCs",
                CurrentConfig.IgnoreCustomTabs,
                (isChecked) => CurrentConfig.Update(ignoreCustomTabs : isChecked));

            helper.AddSpace(16);
            helper.AddButton("Reset to default", 
                () =>
                {
                    // This not only updates the config, but also updates the checkboxes.
                    dontExtractTransportModesCheckbox.isChecked = false;
                    useStandardSortingCheckbox.isChecked = false;
                    ignoreCustomTabsCheckbox.isChecked = false;
                });

            helper.AddSpace(16);

            if (ToolsModifierControl.isGame)
            {
                helper.AddGroup("Any changes will only be applied after restarting the game.");
            }
        }

        public static string Identifier = "WQ.BRT/";

        public static Config CurrentConfig = new Config();
    }
}
